CREATE TABLE usuarios (
    ra INT(9) PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(50) NOT NULL,
	cpf VARCHAR(14) NOT NULL,
	genero INT(1) NOT NULL,
	dt_NASC DATE NOT NULL,
	email VARCHAR(50) NOT NULL,
    senha VARCHAR(30) NOT NULL,
    dt_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    tipo INT(1) NOT NULL
);

CREATE TABLE funcionarios (
    ra INT(9),
    id INT(9) PRIMARY KEY AUTO_INCREMENT,
    dt_CONTRATO DATE NOT NULL,
    FOREIGN KEY (ra) REFERENCES usuarios(ra)
);

INSERT INTO usuarios (ra, nome, cpf, genero, dt_nasc, email, senha, tipo)
VALUES (1111111, 'Administrador', '000.000.000-00', 1, '2002-02-27', 'admin@gmail.com', 'admin', 1);


INSERT INTO funcionarios (ra, dt_CONTRATO)
VALUES (1111111, '2015-02-27');

ALTER TABLE escola_db.usuarios
AUTO_INCREMENT = 1111112;



    
CREATE TABLE tipo(
	id INT(1) PRIMARY KEY,
	descricao VARCHAR(20) NOT NULL
	);
INSERT INTO tipo(id, descricao) VALUES (1, 'Gerente');
INSERT INTO tipo(id, descricao) VALUES (2, 'Professor')	;
INSERT INTO tipo(id, descricao) VALUES (3, 'Aluno');




CREATE TABLE turmas (
    id INT(3) PRIMARY KEY AUTO_INCREMENT,
    desc_turma VARCHAR(20)
	);

INSERT INTO turmas(desc_turma) VALUES('Turma A');
INSERT INTO turmas(desc_turma) VALUES('Turma B');
INSERT INTO turmas(desc_turma) VALUES('Turma C');
INSERT INTO turmas(desc_turma) VALUES('Turma D');
INSERT INTO turmas(desc_turma) VALUES('Turma E');
INSERT INTO turmas(desc_turma) VALUES('Turma F');
INSERT INTO turmas(desc_turma) VALUES('Turma G');
INSERT INTO turmas(desc_turma) VALUES('Turma H');
INSERT INTO turmas(desc_turma) VALUES('Turma I');
INSERT INTO turmas(desc_turma) VALUES('Turma J');




CREATE TABLE alunos (
    ra INT(9),
    id INT(9) PRIMARY KEY AUTO_INCREMENT,
    dt_MATRICULA DATE NOT NULL,
    id_turma INT(3),
    FOREIGN KEY (ra) REFERENCES usuarios(ra),
    FOREIGN KEY (id_turma) REFERENCES turmas(id)
);


CREATE TABLE materias (
    id INT(5) PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) NOT NULL,
    quant_aulas INT(3) NOT NULL
);

INSERT INTO materias (nome, quant_aulas) VALUES ('Matemática', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Português', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Geografia', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('História', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Biologia', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Filosofia', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Química', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Física', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Sociologia', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Artes', 40);
INSERT INTO materias (nome, quant_aulas) VALUES ('Educação Física', 40);


	
CREATE TABLE notas (
    id INT(20) PRIMARY KEY AUTO_INCREMENT,
    id_aluno INT(9),
    id_materia INT(5),
    nota DECIMAL(3,2) NOT NULL,
    data_atribuida DATE NOT NULL,
    tipo INT(1) NOT NULL,
    FOREIGN KEY (id_aluno) REFERENCES alunos(ra),
    FOREIGN KEY (id_materia) REFERENCES materias(id)
);

	
CREATE TABLE frequencia (
    id INT(20) PRIMARY KEY AUTO_INCREMENT,
    id_aluno INT(9),
    id_materia INT(5),
    data_atribuida DATE NOT NULL,
    desc_frequencia INT(1) NOT NULL,
    FOREIGN KEY (id_aluno) REFERENCES alunos(ra),
    FOREIGN KEY (id_materia) REFERENCES materias(id)
);

	
	
CREATE TABLE professor_materia (
    id INT(5) PRIMARY KEY AUTO_INCREMENT,
    id_prof INT(9),
    id_materia INT(5),
    FOREIGN KEY (id_prof) REFERENCES funcionarios(ra),
    FOREIGN KEY (id_materia) REFERENCES materias(id)
);

	
	
CREATE TABLE professor_turma (
    id INT(5) PRIMARY KEY AUTO_INCREMENT,
    id_prof INT(9),
    id_turma INT(5),
    FOREIGN KEY (id_prof) REFERENCES funcionarios(ra),
    FOREIGN KEY (id_turma) REFERENCES turmas(id)
);






	
CREATE VIEW view_alunos_turmas AS
SELECT u.ra, u.nome, t.desc_turma, t.id
FROM usuarios AS u
JOIN alunos AS a ON u.ra = a.ra
JOIN turmas AS t ON a.id_turma = t.id
WHERE u.tipo = 3;





